{"version":3,"file":"yamjs.es.js","sources":["../src/yamjs/webserver.ts"],"sourcesContent":["import { lifecycle } from '@yam-js/core'\r\n\r\nexport const initializeDevReload = () => {\r\n  const HttpServer = Java.type('com.sun.net.httpserver.HttpServer')\r\n  const InetSocketAddress = Java.type('java.net.InetSocketAddress')\r\n\r\n  class ApiHandler {\r\n    constructor() {\r\n      this.handle = this.handle.bind(this)\r\n    }\r\n\r\n    handle(exchange) {\r\n      const requestMethod = exchange.getRequestMethod()\r\n      if (requestMethod === 'GET') {\r\n        // Send Response\r\n        const response = 'Done' // use a JavaScript string\r\n        exchange.sendResponseHeaders(200, response.length)\r\n        const os = exchange.getResponseBody()\r\n        os.write(response.split('').map((c) => c.charCodeAt(0))) // convert string to byte array\r\n        os.close()\r\n\r\n        // Reload\r\n        lifecycle.reload()\r\n      } else {\r\n        exchange.sendResponseHeaders(405, -1) // 405 Method Not Allowed\r\n      }\r\n    }\r\n  }\r\n\r\n  const server = HttpServer.create(new InetSocketAddress(8000), 0)\r\n  server.createContext('/reload', new ApiHandler())\r\n  server.start()\r\n\r\n  lifecycle.register('onDisable', {\r\n    hook: () =>\r\n      new Promise<void>((resolve) => {\r\n        server.stop(0)\r\n\r\n        // Need delay to make sure server is stopped\r\n        setTimeout(() => {\r\n          resolve()\r\n        }, 10)\r\n      }),\r\n    name: 'yamjs-dev-reload',\r\n  })\r\n}\r\n"],"names":["initializeDevReload","HttpServer","InetSocketAddress","ApiHandler","exchange","response","os","c","lifecycle","server","resolve"],"mappings":";AACO,MAAMA,IAAsB,MAAM;AACjC,QAAAC,IAAa,KAAK,KAAK,mCAAmC,GAC1DC,IAAoB,KAAK,KAAK,4BAA4B;AAChE,QAAMC,EAAW;AAAA,IACf,cAAc;AACZ,WAAK,SAAS,KAAK,OAAO,KAAK,IAAI;AAAA,IACrC;AAAA,IACA,OAAOC,GAAU;AAEf,UADsBA,EAAS,uBACT,OAAO;AAE3B,cAAMC,IAAW;AACR,QAAAD,EAAA,oBAAoB,KAAKC,EAAS,MAAM;AAC3C,cAAAC,IAAKF,EAAS;AACjB,QAAAE,EAAA,MAAMD,EAAS,MAAM,EAAE,EAAE,IAAI,CAAAE,MAAKA,EAAE,WAAW,CAAC,CAAC,CAAC,GACrDD,EAAG,MAAM,GAGTE,EAAU,OAAO;AAAA;AAER,QAAAJ,EAAA,oBAAoB,KAAK,EAAE;AAAA,IAExC;AAAA,EACF;AAEA,QAAMK,IAASR,EAAW,OAAO,IAAIC,EAAkB,GAAI,GAAG,CAAC;AAC/D,EAAAO,EAAO,cAAc,WAAW,IAAIN,EAAY,CAAA,GAChDM,EAAO,MAAM,GACbD,EAAU,SAAS,aAAa;AAAA,IAC9B,MAAM,MAAM,IAAI,QAAQ,CAAWE,MAAA;AACjC,MAAAD,EAAO,KAAK,CAAC,GAGb,WAAW,MAAM;AACP,QAAAC;SACP,EAAE;AAAA,IAAA,CACN;AAAA,IACD,MAAM;AAAA,EAAA,CACP;AACH;"}