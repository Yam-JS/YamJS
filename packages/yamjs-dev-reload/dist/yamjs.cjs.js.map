{"version":3,"file":"yamjs.cjs.js","sources":["../src/yamjs/webserver.ts"],"sourcesContent":["import { lifecycle } from '@yam-js/core'\r\n\r\nexport const initializeDevReload = () => {\r\n  const HttpServer = Java.type('com.sun.net.httpserver.HttpServer')\r\n  const InetSocketAddress = Java.type('java.net.InetSocketAddress')\r\n\r\n  class ApiHandler {\r\n    constructor() {\r\n      this.handle = this.handle.bind(this)\r\n    }\r\n\r\n    handle(exchange) {\r\n      const requestMethod = exchange.getRequestMethod()\r\n      if (requestMethod === 'GET') {\r\n        // Send Response\r\n        const response = 'Done' // use a JavaScript string\r\n        exchange.sendResponseHeaders(200, response.length)\r\n        const os = exchange.getResponseBody()\r\n        os.write(response.split('').map((c) => c.charCodeAt(0))) // convert string to byte array\r\n        os.close()\r\n\r\n        // Reload\r\n        lifecycle.reload()\r\n      } else {\r\n        exchange.sendResponseHeaders(405, -1) // 405 Method Not Allowed\r\n      }\r\n    }\r\n  }\r\n\r\n  const server = HttpServer.create(new InetSocketAddress(8000), 0)\r\n  server.createContext('/reload', new ApiHandler())\r\n  server.start()\r\n\r\n  lifecycle.register('onDisable', {\r\n    hook: () =>\r\n      new Promise<void>((resolve) => {\r\n        server.stop(0)\r\n\r\n        // Need delay to make sure server is stopped\r\n        setTimeout(() => {\r\n          resolve()\r\n        }, 10)\r\n      }),\r\n    name: 'yamjs-dev-reload',\r\n  })\r\n}\r\n"],"names":["initializeDevReload","HttpServer","InetSocketAddress","ApiHandler","exchange","response","os","c","lifecycle","server","resolve"],"mappings":"gHACaA,EAAsB,IAAM,CACjC,MAAAC,EAAa,KAAK,KAAK,mCAAmC,EAC1DC,EAAoB,KAAK,KAAK,4BAA4B,EAChE,MAAMC,CAAW,CACf,aAAc,CACZ,KAAK,OAAS,KAAK,OAAO,KAAK,IAAI,CACrC,CACA,OAAOC,EAAU,CAEf,GADsBA,EAAS,qBACT,MAAO,CAE3B,MAAMC,EAAW,OACRD,EAAA,oBAAoB,IAAKC,EAAS,MAAM,EAC3C,MAAAC,EAAKF,EAAS,kBACjBE,EAAA,MAAMD,EAAS,MAAM,EAAE,EAAE,IAAIE,GAAKA,EAAE,WAAW,CAAC,CAAC,CAAC,EACrDD,EAAG,MAAM,EAGTE,EAAA,UAAU,OAAO,OAERJ,EAAA,oBAAoB,IAAK,EAAE,CAExC,CACF,CAEA,MAAMK,EAASR,EAAW,OAAO,IAAIC,EAAkB,GAAI,EAAG,CAAC,EAC/DO,EAAO,cAAc,UAAW,IAAIN,CAAY,EAChDM,EAAO,MAAM,EACbD,EAAA,UAAU,SAAS,YAAa,CAC9B,KAAM,IAAM,IAAI,QAAmBE,GAAA,CACjCD,EAAO,KAAK,CAAC,EAGb,WAAW,IAAM,CACPC,KACP,EAAE,CAAA,CACN,EACD,KAAM,kBAAA,CACP,CACH"}