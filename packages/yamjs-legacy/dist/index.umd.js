(function(i,p){typeof exports=="object"&&typeof module<"u"?p(exports,require("@yam-js/core")):typeof define=="function"&&define.amd?define(["exports","@yam-js/core"],p):(i=typeof globalThis<"u"?globalThis:i||self,p(i["yamjs-legacy"]={},i.YamJS))})(this,function(i,p){"use strict";const u=globalThis.Yam,L=u;if("Yam"in globalThis)Object.assign(globalThis,{Core:u});else if("Core"in globalThis)Object.assign(globalThis,{Yam:L});else throw"Polyglot"in globalThis?"YamJS was not detected (or is very outdated) in your environment!":"Java"in globalThis?"GraalJS was not detected in your environment!":"Java was not detected in your environment!";const d={data:new Map,load:new Map,poly:{index:0,list:new Map},task:{list:new Set,tick:0}},x=Java.type("java.nio.file.Files"),F=Java.type("java.lang.String"),I=Java.type("java.nio.file.Paths"),W=Java.type("java.util.regex.Pattern"),Y=Java.type("java.util.Scanner"),H=Java.type("java.net.URL"),B=Java.type("java.util.UUID"),k={async provide(e){try{const{data:r,uuid:t}=JSON.parse(h.meta);try{h.emit(t,JSON.stringify({data:await e(r),status:!0}))}catch(n){h.emit(t,JSON.stringify({data:n,status:!1}))}}catch{throw"The current context's metadata is incompatible with the desync system!"}},async request(e,r={}){if(m(e).exists){const n=B.randomUUID().toString(),a=h.on(n);h.create("file",m(e).io.getAbsolutePath(),JSON.stringify({data:r,uuid:n})).open();const s=JSON.parse(await a);if(s.status)return s.data;throw s.data}else throw"That file does not exist!"},shift(e){switch(l.name){case"bukkit":return new Promise((r,t)=>{l.content.server.getScheduler().runTaskAsynchronously(l.content.plugin,new l.content.Runnable(async()=>{try{r(await e())}catch(n){t(n)}}))});case"minestom":return new Promise(async(r,t)=>{try{r(await e())}catch(n){t(n)}})}}};function b(e,r){const t=n=>{try{return r(n,t)}catch(a){throw a}};return t(e)}function A(e){switch(l.name){case"bukkit":{l.content.plugin.register(e.namespace||l.content.plugin.getName(),e.name,e.aliases||[],e.permission||"",e.message||"",(r,t,n)=>{p.catchAndLogUnhandledError(()=>{!e.permission||r.hasPermission(e.permission)?e.execute&&e.execute(r,...n):r.sendMessage(e.message||"")},`An error occured while attempting to execute the "${t}" command!`)},(r,t,n)=>p.catchAndLogUnhandledError(()=>e.tabComplete&&e.tabComplete(r,...n)||[],`An error occured while attempting to tab-complete the "${t}" command!`)??[]);break}case"minestom":{const r=new l.content.Command(e.name);r.addSyntax((t,n)=>{try{e.execute&&e.execute(t,...n.getInput().split(" ").slice(1))}catch(a){console.error(`An error occured while attempting to execute the "${e.name}" command!`),console.error(a.stack||a.message||a)}},l.content.ArgumentType.StringArray("tab-complete").setSuggestionCallback((t,n,a)=>{for(const s of e.tabComplete(t,...n.getInput().split(" ").slice(1))||[])a.addEntry(new l.content.SuggestionEntry(s))})),l.content.registry.register(r)}}}const T={cancel(e){d.task.list.delete(e)},interval(e,r=0,...t){const n=T.timeout((...a)=>{try{n.tick+=Math.ceil(r<1?1:r),e(...a)}catch(s){console.error("future task interval error",s)}},0,...t);return n},timeout(e,r=0,...t){const n={tick:d.task.tick+Math.ceil(r<0?0:r),args:t,script:(...a)=>{try{e(...a)}catch(s){console.error("future task timeout error",s)}}};return d.task.list.add(n),n}},h={create(e,r,t){return u[`${e}Instance`](r,t)},destroy(){u.destroy()},emit(e,r){u.emit(e,r)},meta:u.getMeta(),off(e,r){return u.off(e,r)},on:(e,r)=>r?u.on(e,r):new Promise(t=>{const n=a=>{h.off(e,n),t(a)};h.on(e,n)}),swap(){$(u.swap)}};function U(e,...r){const t=I.get(e,...r).normalize().toString();if(d.data.has(t))return d.data.get(t);{const n=m(J,"data",`${t}.json`).json()||{};return d.data.set(t,n),n}}const l=(()=>{try{return{content:{manager:p.manager,plugin:p.plugin,Runnable:Java.type("java.lang.Runnable"),server:p.server},name:"bukkit"}}catch{try{const r=Java.type("net.minestom.server.MinecraftServer"),t=r.getExtensionManager(),n=t.getExtension("Yam");return{content:{ArgumentType:Java.type("net.minestom.server.command.builder.arguments.ArgumentType"),Command:Java.type("net.minestom.server.command.builder.Command"),extension:n,manager:t,node:n.getEventNode(),registry:r.getCommandManager(),server:r,SuggestionEntry:Java.type("net.minestom.server.command.builder.suggestion.SuggestionEntry")},name:"minestom"}}catch{return{name:"unknown",content:{}}}}})();function j(e){const r={json(t){if(t)return r.read(!0).then(n=>JSON.parse(n));try{return JSON.parse(r.read())}catch(n){throw n}},read(t){return t?k.request(N,{link:e,operation:"fetch.read"}):new Y(r.stream()).useDelimiter("\\A").next()},stream(){return new H(e).openStream()}};return r}function m(e,...r){e=typeof e=="string"?e:"io"in e?e.path:e.getPath();const t=I.get(e,...r).normalize().toFile(),n={get children(){return n.type==="folder"?[...t.listFiles()].map(a=>m(a.getPath())):null},directory(){return n.type==="none"&&b(t,(a,s)=>{const o=a.getParentFile();o&&(o.exists()||s(o)),a.mkdir()}),n},entry(){return n.type==="none"&&n.parent.directory()&&t.createNewFile(),n},get exists(){return t.exists()},file(...a){return m(t,...a)},flush(){return b(t,(a,s)=>{const o=a.getParentFile();o&&o.isDirectory()&&(o.listFiles()[0]||o.delete()&&s(o))}),n},io:t,json(a){if(a)return n.read(!0).then(s=>JSON.parse(s));try{return JSON.parse(n.read())}catch{return null}},get name(){return t.getName()},get parent(){return n.file("..")},get path(){return v.replace(t.getPath(),"(\\\\)","/")},read(a){return a?k.request(N,{operation:"file.read",path:n.path}):n.type==="file"?new F(x.readAllBytes(t.toPath())).toString():null},remove(){return b(t,(a,s)=>{a.isDirectory()&&[...a.listFiles()].forEach(s),a.exists()&&a.delete()}),n.flush()},get type(){return t.isDirectory()?"folder":t.exists()?"file":"none"},write(a,s){return s?k.request(N,{content:a,operation:"file.write",path:n.path}).then(()=>n):(n.type==="file"&&x.write(t.toPath(),new F(a).getBytes()),n)}};return n}function _(e,r){if(d.load.has(r))return d.load.get(r);{const t=m(e);if(t.exists){const n=u.load(t.io,r);return d.load.set(r,n),n}else throw new ReferenceError(`The file "${t.path}" does not exist!`)}}function $(e){u.push(e)}const v={test(e,r){return e.matches(r)},replace(e,r,t){return W.compile(r).matcher(e).replaceAll(t)}};function R(){$(u.reload||u.swap)}const J=m(u.getRoot());function P(e,r,t){if(e&&typeof e=="object"){if(t||(t=new Set),t.has(e))return r;{t.add(e);const n=typeof e[Symbol.iterator]=="function"?[]:{};for(const a in e)n[a]=P(e[a],r,new Set(t));return n}}else return e}function q(e){return new Promise((r,t)=>{u.sync(()=>e().then(r).catch(t))})}u.hook(()=>{for(const[e]of d.data)m(J,"data",`${e}.json`).entry().write(JSON.stringify(P(d.data.get(e))))});const N=`${__dirname}/async.js`,z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Z=Promise.resolve();Object.assign(globalThis,{atob(e){var r=v.replace(String(e),"[=]+$","");if(r.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t=0,n,a,s=0,o="";a=r.charAt(s++);~a&&(n=t%4?n*64+a:a,t++%4)?o+=String.fromCharCode(255&n>>(-2*t&6)):0)a=z.indexOf(a);return o},btoa(e){for(var r=String(e),t,n,a=0,s=z,o="";r.charAt(a|0)||(s="=",a%1);o+=s.charAt(63&t>>8-a%1*8)){if(n=r.charCodeAt(a+=3/4),n>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return o},queueMicrotask(e){Z.then(e).catch(r=>{T.timeout(()=>{throw r})})}});const G=Object.freeze(Object.defineProperty({__proto__:null,chain:b,command:A,context:h,data:U,desync:k,env:l,fetch:j,file:m,load:_,push:$,regex:v,reload:R,root:J,session:d,simplify:P,sync:q,task:T},Symbol.toStringTag,{value:"Module"})),E=Java.type("java.lang.Class"),K=Java.type("java.lang.Iterable"),Q=Java.type("java.util.Iterator"),V=Java.type("java.util.Spliterator");function X(e){if(e instanceof Array)return[...e];if(e instanceof K){const r=[];return e.forEach(t=>{r.push(t)}),r}else if(e instanceof Q||e instanceof V){const r=[];return e.forEachRemaining(t=>{r.push(t)}),r}else return null}const C=Symbol(),w={error(e){let r="Error",t=`${e}`;if(e.stack)switch(r=e.stack.split(`
`)[0].split(" ")[0].slice(0,-1),t=e.message,r){case"TypeError":try{if(t.startsWith("invokeMember")||t.startsWith("execute on foreign object")){const n=t.split("failed due to: ")[1];n.startsWith("no applicable overload found")?t=["Invalid arguments! Expected:",...n.split("overloads:")[1].split("]],")[0].split(")]").map(s=>`(${s.split("(").slice(1).join("(")})`)].join(`
 -> `).slice(0,-1):n.startsWith("Arity error")?t=`Invalid argument amount! Expected: ${n.split("-")[1].split(" ")[2]}`:n.startsWith("UnsupportedTypeException")?t="Invalid arguments!":n.startsWith("Unknown identifier")?t=`That method (${n.split(": ")[1]}) does not exist!`:n.startsWith("Message not supported")?t=`That method (${t.slice(14).split(")")[0]}) does not exist!`:t=t.split(`
`)[0]}}catch{t=t.split(`
`)[0]}break;case"SyntaxError":t=t.split(" ").slice(1).join(" ").split(`
`)[0]}else e=`${e}`,r=e.split(" ")[0].slice(0,-1),t=e.split(" ").slice(1).join(" ");return`${r}: ${t}`},output(e,r){if(r===!0){if(e===C)return"...";{const t=toString.call(e);switch(t){case"[object Array]":case"[object Object]":case"[object Function]":return t.split(" ")[1].slice(0,-1);case"[foreign HostObject]":if(e instanceof E&&typeof e.getCanonicalName=="function")return e.getCanonicalName();if(typeof e.toString=="function"){const a=e.toString();if(a)return a}const n=typeof e.getClass=="function"?e.getClass():e.class;return n instanceof E&&typeof n.getCanonicalName=="function"?n.getCanonicalName():`${e}`||`${n}`||"Object";case"[foreign HostFunction]":return"Function";default:switch(typeof e){case"bigint":return e.toString()+"n";case"function":return"Function";case"object":return e?"Object":"null";case"symbol":return`<${e.toString().slice(7,-1)}>`;case"undefined":return"undefined";default:return JSON.stringify(e)}}}}else switch(toString.call(e)){case"[object Array]":return`[ ${[...e].map(n=>w.output(e===n?C:n,!0)).join(", ")} ]`;case"[object Object]":return`{ ${[...Object.getOwnPropertyNames(e).map(n=>`${n}: ${w.output(e===e[n]?C:e[n],!0)}`),...Object.getOwnPropertySymbols(e).map(n=>`${w.output(n,!0)}: ${w.output(e===e[n]?C:e[n],!0)}`)].join(", ")} }`;case"[object Function]":return e instanceof E&&typeof e.getCanonicalName=="function"?e.getCanonicalName():typeof e.toString=="function"?v.replace(e.toString(),"\\r",""):`${e}`||"function () { [native code] }";case"[foreign HostFunction]":return"hostFunction () { [native code] }";default:const t=X(e);return t?w.output(t):w.output(e,!0)}}};A({name:"js",permission:"grakkit.command.js",message:"§cYou do not have the required permission to run this command!",execute(e,...r){const t=globalThis.hasOwnProperty("self");t||(globalThis.self=e);let n;try{const a=Polyglot.eval("js",r.join(" "));t||delete globalThis.self,n=w.output(a)}catch(a){t||delete globalThis.self,n=w.error(a)}switch(l.name){case"bukkit":e.sendMessage(n);break;case"minestom":e.sendMessage(n);break}},tabComplete(e,...r){let t="",n=-1,a=globalThis,s=!0,o=!1,f=!1,O=!1,g="";const y=r.join(" ");for(;s&&++n<y.length;){const c=y[n];if(O)c==="*"&&y[n+1]==="/"&&(g?y[n+2]===";"&&(O=!1):(t=y.slice(0,n+2),O=!1));else if(o)c==="\\"?++n:c===o&&(a={},o=!1);else if(f===!0)["'",'"',"`"].includes(c)?f=c:s=!1;else if(typeof f=="string")switch(c){case"\\":++n;break;case f:f=-1;break;default:g+=c}else switch(c){case"/":switch(y[n+1]){case"/":s=!1;break;case"*":O=!0;break}break;case"'":case'"':case"`":f===-1?s=!1:o=c;break;case")":case"{":case"}":f||(a={});break;case".":case"[":f||(c==="."||g?(t=y.slice(0,n+1),a===globalThis&&g==="self"&&!a.hasOwnProperty("self")?a=e:a=a[g]||{},c==="."||(f=!0),g=""):(t=y.slice(0,n+1),a=globalThis));break;case"]":f===-1&&(f=!1);break;case"\\":typeof f=="string"?++n:s=!1;break;case" ":g?s=!1:t="";break;default:v.test(c,"[\\+\\-\\*\\/\\^=!&\\|\\?:\\(,;]")?f||(t=y.slice(0,n+1),a=globalThis,g=""):g+=c}}if(s&&a&&!(O||o)){const c=[...Object.getOwnPropertyNames(a.constructor?a.constructor.prototype||{}:{}),...Object.getOwnPropertyNames(a)];return a===globalThis&&!c.includes("self")&&c.push("self"),c.sort().filter(S=>S.toLowerCase().includes(g.toLowerCase())).filter(S=>f||v.test(S,"[_A-Za-z$][_0-9A-Za-z$]*")).map(S=>f?`${t}\`${v.replace(S,"`","\\`").split("\\").join("\\\\")}\`]`:`${t}${S}`)}else return[]}});const D={manager:l.content.manager,plugin:l.content.plugin,server:l.content.server},M=Object.assign({},G,D);Object.assign(globalThis,D,{core:M}),i.chain=b,i.command=A,i.context=h,i.data=U,i.default=M,i.desync=k,i.env=l,i.fetch=j,i.file=m,i.load=_,i.push=$,i.regex=v,i.reload=R,i.root=J,i.session=d,i.simplify=P,i.stdlib=M,i.sync=q,i.task=T,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
